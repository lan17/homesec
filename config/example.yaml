# HomeSec Pipeline Configuration Example
# See DESIGN.md for full documentation

version: 1

cameras:
  - name: front_door
    source:
      type: rtsp
      config:
        rtsp_url_env: FRONT_DOOR_RTSP_URL
#        detect_rtsp_url_env: FRONT_DOOR_RTSP_SUB_URL
        output_dir: "./recordings"
        pixel_threshold: 45
        min_changed_pct: 1.0
        blur_kernel: 5
        stop_delay: 10
        max_recording_s: 60
        frame_timeout_s: 2.0
        reconnect_backoff_s: 1.0

storage:
  backend: dropbox
  dropbox:
    root: "/homecam"
    token_env: DROPBOX_TOKEN
    app_key_env: DROPBOX_APP_KEY
    app_secret_env: DROPBOX_APP_SECRET
    refresh_token_env: DROPBOX_REFRESH_TOKEN
    web_url_prefix: "https://www.dropbox.com/home"

state_store:
  dsn_env: DB_DSN

notifiers:
  - backend: mqtt
    config:
      host: "localhost"
      port: 1883
      auth:
        username_env: MQTT_USERNAME
        password_env: MQTT_PASSWORD
      topic_template: "homecam/alerts/{camera_name}"
      qos: 1
      retain: false
  # - backend: sendgrid_email
  #   config:
  #     api_key_env: SENDGRID_API_KEY
  #     from_email: "alerts@example.com"
  #     from_name: "HomeSec"
  #     to_emails: ["you@example.com"]

filter:
  plugin: "yolo"
  max_workers: 4
  config:
    # model_path defaults to yolo11n.pt (cached under ./yolo_cache)
    classes: ["person", "animal"]
    min_confidence: 0.5
    sample_fps: 2

vlm:
  backend: "openai"
  trigger_classes: ["person"]
  max_workers: 2
  llm:
    api_key_env: "OPENAI_API_KEY"
    model: "gpt-4o"
  preprocessing:
    max_frames: 10
    max_size: 1024
    quality: 85

alert_policy:
  backend: default
  enabled: true
  config:
    min_risk_level: "medium"
    notify_on_activity_types: []
    notify_on_motion: false

per_camera_alert:
  front_door:
    min_risk_level: "low"
    notify_on_activity_types: ["person_at_door", "delivery"]
